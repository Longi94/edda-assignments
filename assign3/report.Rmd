---
title: "Assignment 3"
author: "Daniel Galea, Konrad Karas and Long Tran, group 6"
date: "14 March 2018"
output: pdf_document
fontsize: 11pt
highlight: tango
---

```{r, echo = FALSE, message = FALSE}
library(knitr)
library(multcomp)
library(lme4)
```

## Exercises

### Exercise 1

Investigating our dataset (bread.txt) we can distinguish one numerical outcome (hours) and two factors that can be fixed at discrete number of levels (3 levels of environment [cold,intermediate,warm] and 2 levels of humidity [dry,wet]).

```{r}
data = read.table("bread.txt", header=TRUE)
data
```

Such a dataset is a good candidate to be tested by 2-way ANOVA method.

**Point 1**

Data randomization for 2-way ANOVA:

```{r}
N = 3; I = 3; J = 2
rbind(rep(1:I,each=N*J),rep(1:J,N*I),sample(1:(N*I*J)))
```

As a result we obtained 18 experimental units (18 slices of bread) with assigned levels of two factors.

**Point 2**

```{r, echo = FALSE}
boxplot(hours~environment,data=data)
```
```{r, echo = FALSE}
boxplot(hours~humidity,data=data)
```

Looking at boxplots, we can see that for intermediate and warm environments, bread slices decay much faster.
Similar observation corresponds to humidity: wet bread slices decay faster then dry ones.

```{r, echo = FALSE}
attach(data)
interaction.plot(environment,humidity,hours)
interaction.plot(humidity,environment,hours)
```

Interaction plots show that there is significant correlation between environment and humidity factors.
Bread slices decay faster when they are wet and are kept in intermediate or warm environment.

**Point 3**

Analysis of variance:
To test the variance we decided to use 2-way ANOVA as we have one numerical outcome (hours) and two factors with fixed levels (humidity and environment).

```{r}
data$environment = as.factor(data$environment)
data$humidity = as.factor(data$humidity)
dataaov = lm(hours~environment*humidity, data=data)
anova(dataaov)
```

Analysis of p-values:

* environment factor have a main effect (p-value = 2.461e-10 < 0.05) 
* humidity factor have a main effect (p-value = 4.316e-06 < 0.05)
* there is significat interaction between environment and humidity (p-value = 3.705e-07 < 0.05)

**Point 4**

Both factors, environment and humidity, interact with each other.
We are not able to test only one factor without second factor taken into account.
We cannot judge which factor has the greatest influence on the decay since factors interact with each other.

**Point 5**

```{r, echo = FALSE}
qqnorm(residuals(dataaov))
qqline(residuals(dataaov))
```

We can distinguish outliers BUT I HAVE NO IDEA HOW TO COMMENT THAT


### Exercise 2

```{r}
search = read.table("search.txt", header = TRUE)
attach(search)
```

**Point 1**

We can randomly assign each student to an interface using the following code.

```{r}
B = 5 # 5 user skill levels
I = 3 # 3 interface types

blocks = matrix(0, B, I)

for (i in 1:B) {
  blocks[i, ] = sample(((i - 1) * I + 1):(i * I))
}

kable(x = blocks, caption = "Randomization of students to interfaces")
```

The numbers in the table are the numbers assigned to each student and each row represents the type of student. The first row contains the student with skill level 1, the second row with skill level 2 and so on. In each row the first student will be assigned to interface 1, the second to interface 2 and the third to interface 3.

**Point 2**

We plot boxplots and interaction graphs.

```{r}
par(mfrow = c(1, 2))

boxplot(time ~ interface)
boxplot(time ~ skill)

interaction.plot(interface, skill, time)
interaction.plot(skill, interface, time)
```

On the first interaction graph a lot of lines are parallel, whil one the second one a lot of lies are nonparallel. We observe more parallel lines than nonparallel ones so we can conclude that there is no significatnt interaction between skill and interface.

**Point 3**

Since the levels of the factors are coded in numbers, we convert them to factors first.

```{r}
search$interface = as.factor(interface)
search$skill = as.factor(skill)
```

We do a 2-way ANOVA test to test the null hypothesis that the search time is the same for all three interfaces. Since in Point 2 we concluded that there are no interaction between skill and interface we do the test on the additive model.

```{r}
aovser = lm(time ~ interface + skill, data = search)
anova(aovser)
```

Both p-values are lower than 0.05, which means that both factors have a significant affect on the model and the null hypothesis can be rejected. The search time is not the same for all interfaces.

**Point 4**

```{r}
multser = glht(aovser, linfct = mcp(skill = "Tukey"))
summary(multser)
```

**Point 5**

```{r}
par(mfrow = c(1, 2))
qqnorm(residuals(aovser))
qqline(residuals(aovser))
plot(fitted(aovser), residuals(aovser))
```

The Q-Q plot indicates a normal distribution and the residuals are distributed evenly. The ANOVA test assumed a normal distribution so these diagnostic plots back the results of the test.

**Point 6**

```{r}
friedman.test(time, interface, skill)
```

We got a p-value of 0.04076 so the null hypothesis that the interface has no effect on the search time can be rejected.

**Point 7**

We do a 1-way ANOVA test.

```{r}
aovinter = lm(time ~ interface, data = search)
anova(aovinter)
```

We got a p-value of 0.09642 so we cannot reject the null hypothesis, that the search time is the same for all interfaces. In the interaction graphs in Point 2 we obsorve that skill as a high impact on the outcome measurement. This analysis is not right to perform since we are ignoring the `skill` variable.

The ANOVA test assumes normal distribution and we can verify this with a Q-Q plot. THe plot below maybe curving slightly, but base don this plot it is still reasonable to assume normal distribution.

```{r}
qqnorm(residuals(aovinter))
qqline(residuals(aovinter))
```

### Exercise 3
```{r}
data = read.table("cream.txt", header=TRUE)
data$starter = factor(data$starter)
data$batch = factor(data$batch)
data$position = factor(data$position)
attach(data)
```
**Point 1**
A three-way test was performed in the following way:
```{r}
model1 = lm(acidity~starter+batch+position,data)
model2 = update(model1, . ~ . - starter:batch:position) #remove interactions
data.aov = aov(model2,data)
summary(data.aov)
```
//Not sure what to write about the summary yet.
**Point 2**
In order to test the hypotheses for all $$H0:\alpha i = \alpha i'$$ on equality of differences of the main effects for starter simultaneously, a multiple comparison test was performed.
```{r}
model = lm(acidity~starter+batch+position, data=data)
startermult = glht(model,linfct=mcp(starter="Tukey"))
summary(startermult)
```
Looking at the P values produced, we can see that $$ \alpha 4 = \alpha 1 $$,$$ \alpha 4 = \alpha 2 $$, $$ \alpha 4 = \alpha 3 $$, and $$ \alpha 5 = \alpha 4 $$ for the previously mentioned null hypothesis are rejected as they are  < 0.05
**Point 3**
//Not sure about this part. can't fid P value from point 1 summary that matches alpha2 = alpha1

**Point 4**
In order to find the confidence intervals for testing all differences of the main effect of starter we could use the "startermult" variable from the second question of this exercise. The test was performed in the following way:
```{r}
confint(startermult, level=0.95)
```
Looking at the result, we can conclude that the intervals [1.3201,4.2999], [1.4701,4.4499], [2.3001,5.2799], and [-4.7835,-1.8045] do not contain the number zero.
### Exercise 4

**Point 1**

**Point 2**

**Point 3**

**Point 4**

### Exercise 5

**Point 1**

**Point 2**

**Point 3**

**Point 4**

### Exercise 6

```{r, echo = FALSE}
data = read.table("airpollution.txt", header=TRUE)
```

**Point 1**

```{r}
pairs(data, panel=panel.smooth)
```

In scatter plots we can see some factors that are highly correlated with oxidant that is a main factor of our investigation. Some slopes are highly positive (oxidant~temperature) or negative (oxidant~wind) so linear regression model should be useful here.

**Point 2**

**Point 3**

**Point 4**

**Point 5**

### Exercise 7
