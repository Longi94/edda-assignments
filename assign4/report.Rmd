---
title: "Assignment 4"
author: "Daniel Galea, Konrad Karas and Long Tran, group 6"
date: "21 March 2018"
output:
  pdf_document: default
  word_document: default
highlight: tango
fontsize: 11pt
---

```{r, echo = FALSE, message = FALSE}
library(knitr)
```

## Exercises


### Exercise 1

```{r}
data = read.table("fruitflies.txt", header=TRUE)
```

**Point 1**


Adding a column *loglongevity* to data-frame, containing the logarithm of the number of days until death:
```{r}
# 1. prepare an array of results
loglongevity = c(1:length(data$longevity))
# 2. calculate logarithm values of longevity for each fly in datafrane
for (i in 1:length(data$longevity)) {
  loglongevity[i] = log(data$longevity[i])
}
# 3. bind new array of results with current dataframe
data = cbind(data,loglongevity)
```
As a result, our dataframe was expanded by new column called *loglongevity* that will be used as an outcome variable in further processing.

Example (showing first 5 rows of data):
```{r, echo=FALSE}
kable(data[c(1:5),])
```

**Point 2**

Our dataframe cointains information about three groups of fruit flies.

* isolated - group of 25 male flies that were kept alone
* low - group of 25 male flies that were kept with one female virgin fly per day
* high - group of 25 male flies that were kept with eight female virgin fly per day

```{r, echo=FALSE}
boxplot(loglongevity~activity,data=data, main="(log)longevity of male flies")
```

Regarding the boxplot chart we can see that mean values of longevity (actually logarithm values) differ depending on group of flies. We can assume that the higher sexual activity is, the shorter life of male fly is.



Analyse of *isolated* group:

```{r, echo=FALSE}
par(mfrow=c(1,2))
log_isolated = data[data$activity == 'isolated',]$loglongevity
hist(log_isolated)
qqnorm(log_isolated)
qqline(log_isolated)
```


\pagebreak
Analyse of *low* group:

```{r, echo=FALSE}
par(mfrow=c(1,2))
log_low = data[data$activity == 'low',]$loglongevity
hist(log_low)
qqnorm(log_low)
qqline(log_low)
```



Analyse of *high* group:

```{r, echo=FALSE}
par(mfrow=c(1,2))
log_high = data[data$activity == 'high',]$loglongevity
hist(log_high)
qqnorm(log_high)
qqline(log_high)
```

\pagebreak
Stripchart to compare three groups:

```{r, echo=FALSE}
flies_loglongevity.data <- data.frame(log_isolated, log_low, log_high)

stripchart(flies_loglongevity.data,vertical=TRUE)
```

Regarding that detailed analyse of each group, we can say that their distribution resambles normal. We need to take into account fact, that our outcome values are logarithmic ones.


A stripchart also shows, that flies with higher sexual activity live shorter than isolated ones.


**Point 3**

In this point statistical test will be performed to check, wether sexual activity influences longevity. Thorax lenght won't be taken into account.

Our model has one numerical output that is *loglongevity* and one factor with fixed values (*activity* - isolated, low, high). For such a model we decided to perform 1-way ANOVA test.


Test results:
```{r}
dataaov=lm(loglongevity~activity,data=data)
anova(dataaov)
```

The p-value for testing H0 : u1 = u2 is 1.798e-07 ( < 0.05 ). We reject null hypothesis.

This test confirms that sexual activity has significant affect on longevity of male flies.

\pagebreak

**Point 4**

Estimation:
```{r}
summary(dataaov)
```
By default R uses treatment contrasts: it takes the first level (here activityhighd) as a base level and compares the other levels to it.

As a result we have obtained estimated longetivities (logarithmic values of days) for the three conditions:

* *high activity* group: **u1 = 3.60**
* *low activity* group: u3-u1 = 0.39 => **u3 = 3.99**
* *isolated* group: u2-u1 = 0.52 => **u2 = 4.12**


95% confidence intervals:
```{r}
confint(dataaov)
```

Estimated longetivities clearly show that isolated male flies live longer than flies with sexual activity. The higher this activity is, the shoter the life of fly is.

\pagebreak

**Point 5**

In this point statistical test will be performed to check, wether sexual activity influences longevity. Thorax lenght will be taken into account now.

Our current model has one numerical output that is *loglongevity*, one factor with fixed values (*activity* - isolated, low, high) and one numerical explanatory variable *thorax*.

For such a model we decided to perform ANCOVA test.

```{r}
data$activity=as.factor(data$activity)
dataaov2=lm(loglongevity~thorax+activity,data=data)
anova(dataaov2)
```

Low p-values ( < 0.05 ) mean that both *thorax* and *activity* have significant affect on output.

**Point 6**

Estimation:

```{r}
contrasts(data$activity)=contr.sum
dataaov3 = lm(loglongevity~thorax+activity,data=data)
summary(dataaov3)
confint(dataaov3)
```

Results:

* u = 1.45
* B = 2.36
* a1 = -0.29 - activity1: isolated
* a2 = 0.11 - activity1: low
* a3 = -a1-a2 = 0.18 - activity1: high

*Model equation:*
$$Y_{i,n} = \mu + \alpha_i + \beta X_{i,n} + e_{i,n} $$

**Estimation for average thorax length:**
```{r}
avg_thorax = mean(data$thorax)
avg_thorax
```

**activity1 - isolated**:
$$Y = 1.45 - 0.29 + (2.36 * 0.82) + e $$
*Result: 3,09*

**activity2 - low**:
$$Y = 1.45 + 0.11 + (2.36 * 0.82) + e $$
*Result: 3,49*

**activity2 - high**:
$$Y = 1.45 + 0.18 + (2.36 * 0.82) + e $$
*Result: 3,56*


**Estimation for smallest thorax length:**

```{r}
min_thorax = min(data$thorax)
min_thorax
```

**activity1 - isolated**:
$$Y = 1.45 - 0.29 + (2.36 * 0.64) + e $$
*Result: 2,67*

**activity2 - low**:
$$Y = 1.45 + 0.11 + (2.36 * 0.64) + e $$
*Result: 3,07*

**activity2 - high**:
$$Y = 1.45 + 0.18 + (2.36 * 0.64) + e $$
*Result: 3,14*

Comment: According to obtained results: we can now assume that the higher the activity is, the longer a fly lives which is an opposite statement to previous results.


**Point 7**

```{r,echo=FALSE}
attach(data)
plot(loglongevity~thorax,pch=as.character(activity))
```

On the plot above we can see correlation between longetivity and thorax depending on activity type (h-high, l-low, i-isolated).

We can see that thorax length is highly correlated with longetivity. The longer the fly lives, the longer it's thorax is.

**Point 8**

We should not take thorax into account when performing tests. The length of thorax depends on how long the fly lives. BLAH BLAH BLAH NO IDEA HELP ME PLS

**Point 9**
```{r, echo=FALSE}
qqnorm(residuals(dataaov2))
plot(fitted(dataaov2),residuals(dataaov2))
```

We can see that distribution follows normal and residuals are spred evenly.


\pagebreak

**Point 10**
```{r}
data$activity=as.factor(data$activity)
dataaov3=lm(longevity~thorax+activity,data=data)  # type second!!!
anova(dataaov3)
qqnorm(residuals(dataaov3))
plot(fitted(dataaov3),residuals(dataaov3))
```


### Exercise 2


**Point 1**


**Point 2**


**Point 3**


**Point 4**


**Point 5**


**Point 6**


**Point 7**


**Point 8**


### Exercise 3


**Point 1**


**Point 2**


**Point 3**


**Point 4**


**Point 5**

